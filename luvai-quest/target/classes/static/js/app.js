//static card resources for spring application
var all = { name: "All", type: "misc", link: "/resources/images/all.png" };
var back = { name: "back", type: "misc", link: "/resources/images/card-back.png" };
var horse = { name: "Horse", type: "weapon", link: "/resources/images/W Horse.jpg" };
var sword = { name: "Sword", type: "weapon", link: "/resources/images/W Sword.jpg" };
var dagger = { name: "Dagger", type: "weapon", link: "/resources/images/W Dagger.jpg" };
var lance = { name: "Lance", type: "weapon", link: "/resources/images/W Lance.jpg" };
var battleAx = { name: "Battle-ax", type: "weapon", link: "/resources/images/W Battle-ax.jpg" };
var excalibur = { name: "Excalibur", type: "weapon", link: "/resources/images/W Excalibur.jpg" };
var robberKnight = { name: "Robber Knight", type: "foe", link: "/resources/images/F Robber Knight.jpg" };
var saxons = { name: "Saxons", type: "foe", link: "/resources/images/F Saxons.jpg" };
var boar = { name: "Boar", type: "foe", link: "/resources/images/F Boar.jpg" };
var thieves = { name: "Thieves", type: "foe", link: "/resources/images/F Thieves.jpg" };
var greenKnight = { name: "Green Knight", type: "foe", link: "/resources/images/F Green Knight.jpg" };
var blackKnight = { name: "Black Knight", type: "foe", link: "/resources/images/F Black Knight.jpg" };
var evilKnight = { name: "Evil Knight", type: "foe", link: "/resources/images/F Evil Knight.jpg" };
var saxonKnight = { name: "Saxon Knight", type: "foe", link: "/resources/images/F Saxon Knight.jpg" };
var dragon = { name: "Dragon", type: "foe", link: "/resources/images/F Dragon.jpg" };
var giant = { name: "Giant", type: "foe", link: "/resources/images/F Giant.jpg" };
var mordred = { name: "Mordred", type: "foe", link: "/resources/images/F Mordred.jpg" };
var sirG = { name: "Sir Gawain", type: "ally", link: "/resources/images/A Sir Gawain.jpg" };
var sirPe = { name: "King Pellinore", type: "ally", link: "/resources/images/A King Pellinore.jpg" };
var sirP = { name: "Sir Percival", type: "ally", link: "/resources/images/A Sir Percival.jpg" };
var sirT = { name: "Sir Tristan", type: "ally", link: "/resources/images/A Sir Tristan.jpg" };
var sirL = { name: "Sir Lance", type: "ally", link: "/resources/images/A Sir Lancelot.jpg" };
var sirGa = { name: "Sir Galahad", type: "ally", link: "/resources/images/A Sir Galahad.jpg" };
var queenG = { name: "Queen Guinevere" , type: "ally", link: "/resources/images/A Queen Guinevere.jpg" };
var queenI = { name: "Queen Iseult", type: "ally", link: "/resources/images/A Queen Iseult.jpg" };
var arthur = { name: "King Arthur", type: "ally", link: "/resources/images/A King Arthur.jpg" };
var merlin = { name: "Merlin", type: "ally", link: "/resources/images/A Merlin.jpg" };
var amour = { name: "Amour", type: "amour", link: "/resources/images/Amour.jpg" };
var chivalrousDeed = { name: "Chivalrous Deed", type: "event", link: "/resources/images/E Chivalrous Deed.jpg" };
var courtCamelot = { name: "Court Called to Camelot", type: "event", link: "/resources/images/E Court Called Camelot.jpg" };
var callToArms = { name: "King's Call to Arms", type: "event", link: "/resources/images/E King's Call to Arms.jpg" };
var recognition = { name: "King's Recognition", type: "event", link: "/resources/images/E King's Recognition.jpg" };
var plague = { name: "Plague", type: "event", link: "/resources/images/E Plague.jpg" };
var pox = { name: "Pox", type: "event", link: "/resources/images/E Pox.jpg" };
var prosperity = { name: "Prosperity Throughout the Realm", type: "event", link: "/resources/images/E Prosperity Throughout the Realm.jpg" };
var queensFavor = { name: "Queen's Favor", type: "event", link: "/resources/images/E Queen's Favor.jpg" };
var testMorgan = { name: "Test of Morgan Le Fey", type: "test", link: "/resources/images/T Test of Morgan Le Fey.jpg" };
var testTemp = { name: "Test of Temptation", type: "test", link: "/resources/images/T Test of the Questing Beast.jpg" };
var testBeast = { name: "Test of the Questing Beast", type: "test", link: "/resources/images/T Test of the Questing Beast.jpg" };
var testValor = { name: "Test of Valor", type: "test", link: "/resources/images/T Test of Valor.jpg" };
var arthurQuest = { name: "Vanquish King Arthur's Enemies", type: "quest", link: "/resources/images/Q Arthur.jpg" };
var beastQuest = { name: "Search for the Questing Beast", type: "quest", link: "/resources/images/Q Beast.jpg" };
var boarQuest = { name: "Boar Hunt", type: "quest", link: "/resources/images/Q Boar.jpg" };
var dragonQuest = { name: "Slay the Dragon", type: "quest", link: "/resources/images/Q Dragon.jpg" };
var forestQuest = { name: "Journey through the Enchanted Forest", type: "quest", link: "/resources/images/Q Forest.jpg" };
var grailQuest = { name: "Search for the Holy Grail", type: "quest", link: "/resources/images/Q Grail.jpg" };
var gkQuest = { name: "Test of the Green Knight", type: "quest", link: "/resources/images/Q Green.jpg" };
var honorQuest = { name: "Defend the Queen's Honor", type: "quest", link: "/resources/images/Q Honor.jpg" };
var maidenQuest = { name: "Rescue the Fair Maiden", type: "quest", link: "/resources/images/Q Maiden.jpg" };
var saxonQuest = { name: "Repel the Saxon Raiders", type: "quest", link: "/resources/images/Q Saxon.jpg" };
var squire = { name: "Squire", type: "rank", link: "/resources/images/R Squire.jpg" };
var knight = { name: "Knight", type: "rank", link: "/resources/images/R Knight.jpg" };
var cKnight = { name: "Champion Knight", type: "rank", link: "/resources/images/R Champion Knight.jpg" };
var camelot = { name: "At Camelot", type: "tournament", link: "/resources/images/T1.jpg" };
var orkney = { name: "At Ornkey", type: "tournament", link: "/resources/images/T2.jpg" };
var tintagel = { name: "At Tintagel", type: "tournament", link: "/resources/images/T3.jpg" };
var york = { name: "At York", type: "tournament", link: "/resources/images/T4.jpg" };
var cardTypeList = [ back, horse, sword, dagger, battleAx, excalibur, robberKnight, saxons, boar, thieves, greenKnight, blackKnight, evilKnight, saxonKnight, dragon, giant, mordred, sirG, sirPe, sirP, sirT, sirL, sirGa, queenG, queenI, arthur, merlin, amour, chivalrousDeed, courtCamelot, callToArms, recognition, plague, pox, prosperity, queensFavor, testMorgan, testTemp, testBeast, testValor, arthurQuest, beastQuest, dragonQuest, forestQuest, grailQuest, gkQuest, honorQuest, maidenQuest, saxonQuest, squire, knight, cKnight, camelot, orkney, tintagel, york];

var PlayerName = "";
var serverMsg = document.getElementById('serverMsg');
var socketConn = new WebSocket('ws://localhost:8080/socketHandler');
var storyCardFaceUp;
var stageCounter = 1;
var stageTracker = 0;
var foes = [];
var weapons = [];
var tempWeaponArr = [];
// when connection is initiated
socketConn.onopen = function(event) {

};

// messages from server received here
socketConn.onmessage = function(event) {
	
	var serverMsg = document.getElementById('serverMsg');
	
	//participation 
	if(event.data=="AskToParticipate") {
		console.log(event.data);
	}
	//get current quest info
	if(event.data.startsWith("currentQuestInfo")) {
		var questInfo = event.data.replace("currentQuestInfo", "");
		questInfo = JSON.parse(questInfo);
		console.log(questInfo);
	}
	// flip story deck
	if (event.data.startsWith("flipStoryDeck")) {
		serverMsg.value = "Flipping card from Story Deck";
		var card = event.data.replace('flipStoryDeck', '');
		card = JSON.parse(card);
		storyCardFaceUp = card;
		stageTracker = storyCardFaceUp.stages;
		$("#storyCard").attr("src", "http://localhost:8080" + card.stringFile);

	}
	// set hand
	if (event.data.startsWith("setHand")) {
		serverMsg.value = "Setting player hand, flipping story deck";
		var handString = event.data.replace('setHand', '');
		var handStringArray = handString.split(":");
		$("#card1").attr("src", handStringArray[0]);
		$("#card2").attr("src", handStringArray[1]);
		$("#card3").attr("src", handStringArray[2]);
		$("#card4").attr("src", handStringArray[3]);
		$("#card5").attr("src", handStringArray[4]);
		$("#card6").attr("src", handStringArray[5]);
		$("#card7").attr("src", handStringArray[6]);
		$("#card8").attr("src", handStringArray[7]);
		$("#card9").attr("src", handStringArray[8]);
		$("#card10").attr("src", handStringArray[9]);
		$("#card11").attr("src", handStringArray[10]);
		$("#card12").attr("src", handStringArray[11]);
	}
	
	// alert player of quest setup
	if (event.data == ("QuestBeingSetup")) {
		serverMsg.value = "Quest is being setup, please wait";
	}
	
	// ask to sponsor quest
	if (event.data === "sponsorQuest") {
		document.getElementById('sponsorQuest').style.display = 'block';
		serverMsg.value = "Click to answer below"
	}

	// if game is full - deny message
	if (event.data.startsWith("Too many players")) {
		serverMsg.value = event.data;
	}
	// welcome message
	if (event.data.startsWith("Welcome")) {
		serverMsg.value = event.data;
	}

	// player enrollment
	if (event.data.startsWith("You are all set up")) {
		serverMsg.value = event.data;
	}

	// game started
	if (event.data.startsWith("All players have joined, starting game...")) {
		document.getElementById('print').disabled = false;
		serverMsg.value = event.data;
	}
}
// setup quest if sponsor
function setupQuestRound() {

	if(stageCounter<=stageTracker) {
		var serverMsg = document.getElementById('serverMsg');
		serverMsg.value += "\nChoose foe card for stage: " + stageCounter;
		$('body').on('click','#card1, #card2, #card3, #card4, #card5, #card6, #card7, #card8, #card9, #card10, #card11, #card12', function() {
			var cardSrc = this.src.replace('http://localhost:8080','');
			cardSrc = cardSrc.split('%20').join(' ');
			var cardName = checkForCardType(cardSrc, "foe");
			if(cardName!="card not found") {
				foes.push(cardName);
				var changeImageId = "#" + this.id;
				$(changeImageId).attr("src", "/resources/images/all.png");
				serverMsg.value = "Choose weapons for foe";
				document.getElementById('doneQuest').style.display = "inline";
				choosingWeapons = true;
				$('body').off('click', '#card1, #card2, #card3, #card4, #card5, #card6, #card7, #card8, #card9, #card10, #card11, #card12');
				$('body').on('click','#card1, #card2, #card3, #card4, #card5, #card6, #card7, #card8, #card9, #card10, #card11, #card12', function() {		
					var cardSrc = this.src.replace('http://localhost:8080','');
					cardSrc = cardSrc.split('%20').join(' ');
					var cardName = checkForCardType(cardSrc, "weapon");
					if(cardName!="card not found") {
						tempWeaponArr.push(cardName)
						var changeImageId = "#"+ this.id;
						$(changeImageId).attr("src","/resources/images/all.png");
					}
				})
			}
		})
	}
}

//
function doneWeaponsQuestSponsor() {

	// var data = JSON.stringify({'name': PlayerName, 'sponsor_quest': false});
	
	var serverMsg = document.getElementById('serverMsg');
	document.getElementById('doneQuest').style.display = "none";

	if (stageCounter == stageTracker) {
		weapons.push(tempWeaponArr);
		tempWeaponArr = [];
		serverMsg.value = "Done setup";
		$('body').off('click', '#card1, #card2, #card3, #card4, #card5, #card6, #card7, #card8, #card9, #card10, #card11, #card12');
		serverMsg.value += '\nWaiting on results...';
		var questData = JSON.stringify({
			'foes': foes,
			'weapons':  weapons
		})
		socketConn.send(questData);
	} else {
		serverMsg.value = "Choose next foe";
		$('body').off('click', '#card1, #card2, #card3, #card4, #card5, #card6, #card7, #card8, #card9, #card10, #card11, #card12');
		weapons.push(tempWeaponArr);
		tempWeaponArr = [];
		stageCounter++;
		setupQuestRound();
		
	}
	
}
// check card type
function checkForCardType(cardSrc, type) {
	for(var i=0; i<cardTypeList.length; i++) {
		if(cardSrc == cardTypeList[i].link) {
			if(cardTypeList[i].type == type) {
				return cardTypeList[i].name;
			}
		}
	}
	return "card not found";
}

// accept to sponsor quest
function acceptSponsorQuest() {
	document.getElementById('sponsorQuest').style.display = 'none';
	var serverMsg = document.getElementById('serverMsg');
	serverMsg.value = "You are sponsor, setting up quest...";
	var data = JSON.stringify({'name': PlayerName, 'sponsor_quest': true});
	socketConn.send(data);
	setupQuestRound();
}
// deny to sponsor quest
function denySponsorQuest() {
	document.getElementById('sponsorQuest').style.display = 'none';
	var data = JSON.stringify({'name': PlayerName, 'sponsor_quest': false});
	socketConn.send(data);
	var serverMsg = document.getElementById('serverMsg');
	serverMsg.value = "Waiting for other players...";
}
// flip story card
function flipStoryDeck() {
	// socketConn.send("flipStoryDeck");
}

// static resource test, changes title back and forth from red and black
function changeColor() {
	var title = document.getElementById('title');
	if (title.className == 'color1') {
		title.className = 'color2';
	} else {
		title.className = 'color1';
	}
}

// send name to server -> adds client to player list
function send() {
	var clientMsg = document.getElementById('enterName');
	if (clientMsg.value) {
		PlayerName = clientMsg.value;
		var data = JSON.stringify({'name': $("#enterName").val()})
		socketConn.send(data);
		document.getElementById('title').innerHTML = "Welcome to the Quest of The Round Table - "
				+ clientMsg.value + "'s View";
		changeColor();
		document.getElementById('enterName').style.display = "none";
		document.getElementById('send').style.display = "none";
	}
}

// print all clients connected
function print() {
	// socketConn.send("Print");
}

// proof of connection - prints deck proof also
function proof() {
	// socketConn.send("Proof");
}


